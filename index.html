<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>주식 물타기 계산기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for the result box to ensure consistent layout */
        .result-box-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }
        /* Style for the alert message box */
        #alert-message {
            display: none;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 0.5rem;
            text-align: center;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <!-- Calculator Container -->
    <div class="bg-white rounded-xl shadow-2xl p-6 sm:p-8 w-full max-w-md">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-2">주식 물타기 계산기</h1>
        <p class="text-center text-gray-500 mb-6">물타기 후의 평균 매수 단가를 계산해 보세요.</p>
        
        <!-- Alert Message Box -->
        <div id="alert-message" class="bg-red-100 text-red-600"></div>

        <!-- Input Fields Group -->
        <div class="space-y-4">
            <div>
                <label for="existingShares" class="block text-sm font-medium text-gray-700">현재 보유 주식 수</label>
                <input type="number" id="existingShares" placeholder="예: 10" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 ease-in-out px-4 py-2">
            </div>

            <div>
                <label for="existingPrice" class="block text-sm font-medium text-gray-700">기존 매수 단가</label>
                <input type="number" id="existingPrice" placeholder="예: 10000" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 ease-in-out px-4 py-2">
            </div>
            
            <div>
                <label for="newShares" class="block text-sm font-medium text-gray-700">추가 매수 주식 수</label>
                <input type="number" id="newShares" placeholder="예: 10" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 ease-in-out px-4 py-2">
            </div>
            
            <div>
                <label for="newPrice" class="block text-sm font-medium text-gray-700">추가 매수 단가</label>
                <input type="number" id="newPrice" placeholder="예: 8000" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 ease-in-out px-4 py-2">
            </div>
        </div>

        <!-- Currency and Conversion Options -->
        <div class="mt-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">통화 선택</label>
            <div class="flex space-x-4">
                <button id="krwBtn" class="flex-1 bg-blue-600 text-white font-semibold rounded-lg py-2 hover:bg-blue-700 transition duration-150 ease-in-out shadow-md">KRW (원)</button>
                <button id="usdBtn" class="flex-1 bg-gray-200 text-gray-800 font-semibold rounded-lg py-2 hover:bg-gray-300 transition duration-150 ease-in-out shadow-md">USD ($)</button>
            </div>
        </div>
        
        <!-- Button Group -->
        <div class="mt-6 flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
            <button id="calculateBtn" class="w-full bg-blue-600 text-white font-semibold rounded-lg py-3 hover:bg-blue-700 transition duration-150 ease-in-out shadow-md">계산하기</button>
            <button id="resetBtn" class="w-full bg-gray-200 text-gray-800 font-semibold rounded-lg py-3 hover:bg-gray-300 transition duration-150 ease-in-out shadow-md">초기화</button>
        </div>
        <button id="downloadBtn" class="mt-4 w-full bg-green-500 text-white font-semibold rounded-lg py-3 hover:bg-green-600 transition duration-150 ease-in-out shadow-md">다운로드</button>

        <!-- Result Box -->
        <div class="result-box-grid mt-8 bg-blue-50 p-6 rounded-xl shadow-inner">
            <div class="flex justify-between items-center text-gray-800">
                <span class="font-medium text-lg">새로운 평균 매수 단가:</span>
                <span id="newAvgPrice" class="font-bold text-xl text-blue-600">0</span>
                <span id="currencyUnit" class="font-medium text-lg">원</span>
            </div>
            <div class="flex justify-between items-center text-gray-800 mt-2">
                <span class="font-medium text-lg">새로운 총 매수 금액:</span>
                <span id="totalCost" class="font-bold text-xl text-blue-600">0</span>
                <span id="costUnit" class="font-medium text-lg">원</span>
            </div>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // HTML elements
            const existingSharesInput = document.getElementById('existingShares');
            const existingPriceInput = document.getElementById('existingPrice');
            const newSharesInput = document.getElementById('newShares');
            const newPriceInput = document.getElementById('newPrice');
            const calculateBtn = document.getElementById('calculateBtn');
            const resetBtn = document.getElementById('resetBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            const newAvgPriceSpan = document.getElementById('newAvgPrice');
            const totalCostSpan = document.getElementById('totalCost');
            const currencyUnitSpan = document.getElementById('currencyUnit');
            const costUnitSpan = document.getElementById('costUnit');
            const krwBtn = document.getElementById('krwBtn');
            const usdBtn = document.getElementById('usdBtn');
            const alertMessage = document.getElementById('alert-message');

            // Exchange rate (fixed)
            const exchangeRate = 1350;
            let currentCurrency = 'KRW';

            function showAlert(message, type) {
                alertMessage.textContent = message;
                alertMessage.style.display = 'block';
                if (type === 'error') {
                    alertMessage.classList.add('bg-red-100', 'text-red-600');
                } else {
                    alertMessage.classList.remove('bg-red-100', 'text-red-600');
                }
            }

            function hideAlert() {
                alertMessage.style.display = 'none';
            }

            function updateCurrencyUI() {
                if (currentCurrency === 'KRW') {
                    krwBtn.classList.remove('bg-gray-200', 'text-gray-800', 'hover:bg-gray-300');
                    krwBtn.classList.add('bg-blue-600', 'text-white', 'hover:bg-blue-700');
                    usdBtn.classList.remove('bg-blue-600', 'text-white', 'hover:bg-blue-700');
                    usdBtn.classList.add('bg-gray-200', 'text-gray-800', 'hover:bg-gray-300');
                    currencyUnitSpan.textContent = '원';
                    costUnitSpan.textContent = '원';
                } else {
                    usdBtn.classList.remove('bg-gray-200', 'text-gray-800', 'hover:bg-gray-300');
                    usdBtn.classList.add('bg-blue-600', 'text-white', 'hover:bg-blue-700');
                    krwBtn.classList.remove('bg-blue-600', 'text-white', 'hover:bg-blue-700');
                    krwBtn.classList.add('bg-gray-200', 'text-gray-800', 'hover:bg-gray-300');
                    currencyUnitSpan.textContent = '$';
                    costUnitSpan.textContent = '$';
                }
            }

            // Currency selection events
            krwBtn.addEventListener('click', () => {
                currentCurrency = 'KRW';
                updateCurrencyUI();
                // Recalculate if values exist to update currency
                if (existingSharesInput.value && existingPriceInput.value) {
                    calculateBtn.click();
                }
            });

            usdBtn.addEventListener('click', () => {
                currentCurrency = 'USD';
                updateCurrencyUI();
                // Recalculate if values exist to update currency
                if (existingSharesInput.value && existingPriceInput.value) {
                    calculateBtn.click();
                }
            });

            // Calculate button click event
            calculateBtn.addEventListener('click', () => {
                const existingShares = parseFloat(existingSharesInput.value);
                const existingPrice = parseFloat(existingPriceInput.value);
                const newShares = parseFloat(newSharesInput.value);
                const newPrice = parseFloat(newPriceInput.value);

                // Input validation
                if (isNaN(existingShares) || isNaN(existingPrice) || isNaN(newShares) || isNaN(newPrice) || 
                    existingShares < 0 || existingPrice < 0 || newShares < 0 || newPrice < 0) {
                    showAlert('유효한 숫자를 입력해 주세요.', 'error');
                    return;
                }

                hideAlert();

                // Calculations
                const totalShares = existingShares + newShares;
                
                // 가중 평균 계산: (기존 주식 수 * 기존 매수 단가) + (추가 매수 주식 수 * 추가 매수 단가)
                const totalCostInCurrency = (existingShares * existingPrice) + (newShares * newPrice);
                const newAvgPriceInCurrency = totalCostInCurrency / totalShares;

                // 통화 단위에 따른 표시 방식 분기
                if (currentCurrency === 'KRW') {
                    // 원화는 소수점 2자리(평균 단가)와 소수점 없는 정수(총 매수 금액)로 표시
                    newAvgPriceSpan.textContent = newAvgPriceInCurrency.toLocaleString('ko-KR', { maximumFractionDigits: 2 });
                    totalCostSpan.textContent = totalCostInCurrency.toLocaleString('ko-KR', { maximumFractionDigits: 0 });
                } else {
                    // 달러는 소수점 2자리(평균 단가)와 소수점 2자리(총 매수 금액)로 표시
                    newAvgPriceSpan.textContent = newAvgPriceInCurrency.toLocaleString('en-US', { maximumFractionDigits: 2 });
                    totalCostSpan.textContent = totalCostInCurrency.toLocaleString('en-US', { maximumFractionDigits: 2 });
                }
            });

            // Reset button click event
            resetBtn.addEventListener('click', () => {
                existingSharesInput.value = '';
                existingPriceInput.value = '';
                newSharesInput.value = '';
                newPriceInput.value = '';
                newAvgPriceSpan.textContent = '0';
                totalCostSpan.textContent = '0';
                hideAlert();
            });
            
            // Download button click event
            downloadBtn.addEventListener('click', () => {
                const htmlContent = document.documentElement.outerHTML;
                const blob = new Blob([htmlContent], { type: 'text/html' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = 'stock_calculator.html';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(a.href);
            });
            
            // Initial UI update
            updateCurrencyUI();
        });
    </script>
</body>
</html>
